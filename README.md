Чат бот кондитерской лавки в VK
===============================

Реализовано:
-----------
 - отправка пользователю меню категорий
 - отправка пользователю товаров из выбранной категории
 - категории, товары (название, описание, цена, фото) хранятся в базе данных
 - удобная админ панель для просмотра, изменения товаров и категорий 
 - загрузка фото товара на сервер VK при его создании/изменении
 - ключи от API VK, ID группы подключаются через переменные окружения
 - запуск бота отдельно от запуска админ панели

Пример работы бота
------------------
[Сообщество ВК для теста бота.](https://vk.com/public216081156)  
- Написать любое сообщение в адрес сообщества или нажать кнопку НАЧАТЬ.  
- Выбрать категорию для просмотра продуктов.

Подготовка к запуску проекта
============================
*Перед запуском нужно иметь регистрацию в VK и созданное сообщество*

-  Получить ключи от API VK
     - Перейти на страницу сообщества -> Управление -> Работа с API
     - Создать ключ. Установить доступ к управлению, сообщениям и фотографиям сообщества.
     - Перейти в раздел Long Poll API -> Настройки, установить Включено.
     - Перейти в Типы событий, проверить, что Входящие сообщения включены.
 
Запуск через docker
-------------------
*Для запуска нужен установленный [docker](https://www.docker.com/).*  
[Ссылка на Docker HUB](https://hub.docker.com/r/denis2603/candy_store)

 - Подготовить файл .env с ключами доступа к API VK (подробнее пункт 3 раздела Запуск из исходных файлов)
 - Из папки с созданным файлом .env выполнить команду:  

      ```commandline
      docker run -d -p 8000:8000 --name candybot --env-file .env denis2603/candy_store
      ```  
      Эта команда скачает и запустит образ, в дальнейшем использовать следующие команды:  
       - запуск `docker start candybot`  
       - остановка  `docker stop candybot`  
       - перезапуск  `docker restart candybot`  

 - Для редактирования категорий и товаров в браузере перейти по адресу [http://127.0.0.1:8000](http://127.0.0.1:8000)  
   Пользователь по умолчанию admin/admin. После внесения изменений выполнить перезапуск. 
 - проверить корректную работу бота написав сообщение в адрес сообщества 


Запуск из исходных файлов
-------------------------

1. Скопировать файлы проекта
    ```commandline
    git clone https://github.com/denis2603/candy_store
    ```
    Эта команда создаст папку `candy_store`  и сохранит в ней все требуемые файлы.  
    Перейти в созданную папку. 
    
   

2. Установить зависимости:
    ```commandline
    pip install -r requirements.txt
    ```
    *Рекомендуется настроить [виртуальное окружение](https://docs.python.org/3/library/venv.html).*

3. Переименовать файл `.env.template` в `.env`, указать в нем полученные ключи от API VK, ID сообщества и  
SECRET_DJANGO_KEY.

    Пример файла `.env`:
    ```dotenv
    VK_KEY=vk1.a.iMASUZ0oVff4FvzvXhYSu----------------------------
    ID_VK_GROUP=123123456
    DJANGO_SECRET_KEY='django-insecure-----------------------------'
    ```
   
4. Для создания базы данный выполнить следующие команды:

    ```bash
    python manage.py makemigrations
    python manage.py migrate
    ```

5. Создать администратора для доступа к управлению товарами:

    ```bash
    python manage.py createsuperuser
    ```

Создание товаров и категорий
----------------------------

Выполнить команду

```bash
python manage.py runserver
```

Перейти в браузере на сайт [http://127.0.0.1:8000/](http://127.0.0.1:8000)  
Для доступа в панель администратора воспользоваться логином и паролем созданным на шаге 6

Запуск чат бота
---------------
Выполнить команду

```bash
python runbot.py
```
Для остановки бота нажать `Ctrl + C`  
При добавлении/изменении товаров необходимо перезапустить чат бота. 
